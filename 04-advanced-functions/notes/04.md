# Module 04 - Lesson 4: Function Composition & Currying

## What is Function Composition?

**Function composition** is combining simple functions to build more complex ones. Think of it like a pipeline where data flows through multiple transformations!

```javascript
// Instead of this:
const result = c(b(a(data)));

// We want this:
const process = compose(c, b, a);
const result = process(data);
```

---

## Basic Composition

### Manual Composition

```javascript
// Simple functions
const double = x => x * 2;
const square = x => x * x;
const addOne = x => x + 1;

// Compose manually
const compute = x => addOne(square(double(x)));

console.log(compute(3));
// double(3) = 6
// square(6) = 36
// addOne(36) = 37
```

### Create Compose Function

```javascript
// Compose function (right to left)
function compose(...functions) {
    return function(value) {
        return functions.reduceRight((acc, fn) => fn(acc), value);
    };
}

// Use it
const double = x => x * 2;
const square = x => x * x;
const addOne = x => x + 1;

const compute = compose(addOne, square, double);

console.log(compute(3));  // 37
```

### Pipe Function (Left to Right)

```javascript
// Pipe (left to right, more intuitive)
function pipe(...functions) {
    return function(value) {
        return functions.reduce((acc, fn) => fn(acc), value);
    };
}

// Use it
const double = x => x * 2;
const square = x => x * x;
const addOne = x => x + 1;

const compute = pipe(double, square, addOne);

console.log(compute(3));  // 37
// double(3) = 6
// square(6) = 36
// addOne(36) = 37
```

---

## Real-World Composition Examples

### Example 1: Data Processing Pipeline

```javascript
// String transformation functions
const trim = str => str.trim();
const toLowerCase = str => str.toLowerCase();
const removeSpaces = str => str.replace(/\s+/g, '');
const addPrefix = str => 'user_' + str;

// Compose them
const processUsername = pipe(
    trim,
    toLowerCase,
    removeSpaces,
    addPrefix
);

console.log(processUsername('  John Doe  '));
// "  John Doe  " â†’ "John Doe" â†’ "john doe" â†’ "johndoe" â†’ "user_johndoe"
```

### Example 2: Number Validation

```javascript
// Validation functions
const isNumber = x => typeof x === 'number';
const isPositive = x => x > 0;
const isLessThan100 = x => x < 100;

// Compose validators
function validate(...validators) {
    return function(value) {
        return validators.every(validator => validator(value));
    };
}

const isValidAge = validate(
    isNumber,
    isPositive,
    isLessThan100
);

console.log(isValidAge(25));    // true
console.log(isValidAge(-5));    // false
console.log(isValidAge(150));   // false
console.log(isValidAge("25"));  // false
```

### Example 3: Array Transformations

```javascript
// Transformation functions
const filterActive = users => users.filter(u => u.active);
const sortByAge = users => [...users].sort((a, b) => a.age - b.age);
const getNames = users => users.map(u => u.name);

// Compose them
const processUsers = pipe(
    filterActive,
    sortByAge,
    getNames
);

const users = [
    { name: "John", age: 30, active: true },
    { name: "Sarah", age: 25, active: false },
    { name: "Mike", age: 35, active: true },
    { name: "Emma", age: 28, active: true }
];

console.log(processUsers(users));
// ["John", "Emma", "Mike"] (active, sorted by age)
```

---

## What is Currying?

**Currying** is transforming a function that takes multiple arguments into a sequence of functions that each take a single argument.

```javascript
// Regular function
function add(a, b, c) {
    return a + b + c;
}

add(1, 2, 3);  // 6

// Curried function
function addCurried(a) {
    return function(b) {
        return function(c) {
            return a + b + c;
        };
    };
}

addCurried(1)(2)(3);  // 6

// Arrow function (cleaner!)
const addCurried = a => b => c => a + b + c;

addCurried(1)(2)(3);  // 6
```

---

## Why Curry?

### 1. Partial Application

```javascript
const multiply = a => b => a * b;

const double = multiply(2);
const triple = multiply(3);
const quadruple = multiply(4);

console.log(double(5));      // 10
console.log(triple(5));      // 15
console.log(quadruple(5));   // 20
```

### 2. Function Configuration

```javascript
const log = level => message => timestamp => {
    console.log(`[${timestamp}] [${level}] ${message}`);
};

const logError = log('ERROR');
const logInfo = log('INFO');
const logDebug = log('DEBUG');

// Use configured functions
logError('Something went wrong')('2025-01-01');
logInfo('App started')('2025-01-01');
logDebug('Processing data')('2025-01-01');
```

### 3. Reusable Logic

```javascript
const filter = predicate => array => array.filter(predicate);

const filterEven = filter(x => x % 2 === 0);
const filterOdd = filter(x => x % 2 !== 0);
const filterPositive = filter(x => x > 0);

let numbers = [1, -2, 3, -4, 5, -6];

console.log(filterEven(numbers));      // [-2, -4, -6]
console.log(filterOdd(numbers));       // [1, 3, 5]
console.log(filterPositive(numbers));  // [1, 3, 5]
```

---

## Automatic Currying

### Create Curry Function

```javascript
function curry(fn) {
    return function curried(...args) {
        if (args.length >= fn.length) {
            return fn(...args);
        } else {
            return function(...moreArgs) {
                return curried(...args, ...moreArgs);
            };
        }
    };
}

// Use it
function add(a, b, c) {
    return a + b + c;
}

const curriedAdd = curry(add);

// All these work!
console.log(curriedAdd(1)(2)(3));      // 6
console.log(curriedAdd(1, 2)(3));      // 6
console.log(curriedAdd(1)(2, 3));      // 6
console.log(curriedAdd(1, 2, 3));      // 6
```

---

## Practical Currying Examples

### Example 1: API Request Builder

```javascript
const request = method => url => headers => data => {
    return fetch(url, {
        method,
        headers,
        body: data ? JSON.stringify(data) : undefined
    });
};

// Create configured requests
const get = request('GET');
const post = request('POST');
const put = request('PUT');
const del = request('DELETE');

// Use them
const getUser = get('/api/users')({ 'Authorization': 'Bearer token' });
const createUser = post('/api/users')({ 'Content-Type': 'application/json' });

getUser(null).then(response => response.json());
createUser({ name: 'John' }).then(response => response.json());
```

### Example 2: Discount Calculator

```javascript
const applyDiscount = discountPercent => price => {
    return price * (1 - discountPercent / 100);
};

const apply10Percent = applyDiscount(10);
const apply20Percent = applyDiscount(20);
const apply50Percent = applyDiscount(50);

console.log(apply10Percent(100));  // 90
console.log(apply20Percent(100));  // 80
console.log(apply50Percent(100));  // 50

// Real usage
let prices = [100, 200, 300, 400];
let discounted = prices.map(apply20Percent);
console.log(discounted);  // [80, 160, 240, 320]
```

### Example 3: Email Sender

```javascript
const sendEmail = from => to => subject => body => {
    console.log(`
        From: ${from}
        To: ${to}
        Subject: ${subject}
        Body: ${body}
    `);
    // Actually send email here
};

// Configure sender
const sendFromSupport = sendEmail('support@example.com');
const sendWelcomeEmail = sendFromSupport(null)('Welcome!');

// Use it
sendWelcomeEmail('new@example.com')('Welcome to our platform!');
sendWelcomeEmail('user2@example.com')('Welcome aboard!');
```

### Example 4: Validator Builder

```javascript
const validate = rules => value => {
    for (let rule of rules) {
        if (!rule.test(value)) {
            return { valid: false, message: rule.message };
        }
    }
    return { valid: true };
};

// Create validators
const validateEmail = validate([
    { test: v => v.includes('@'), message: 'Must contain @' },
    { test: v => v.includes('.'), message: 'Must contain domain' },
    { test: v => v.length >= 5, message: 'Too short' }
]);

const validatePassword = validate([
    { test: v => v.length >= 8, message: 'At least 8 characters' },
    { test: v => /[A-Z]/.test(v), message: 'Must have uppercase' },
    { test: v => /[0-9]/.test(v), message: 'Must have number' }
]);

console.log(validateEmail('test@example.com'));  // { valid: true }
console.log(validateEmail('invalid'));           // { valid: false, ... }
console.log(validatePassword('Pass1234'));       // { valid: true }
```

---

## Combining Composition and Currying

### Example 1: Data Processing

```javascript
// Curried functions
const map = fn => array => array.map(fn);
const filter = predicate => array => array.filter(predicate);
const reduce = (fn, initial) => array => array.reduce(fn, initial);

// Build pipeline
const processNumbers = pipe(
    filter(x => x > 0),
    map(x => x * 2),
    reduce((sum, x) => sum + x, 0)
);

let numbers = [-2, -1, 0, 1, 2, 3, 4];
console.log(processNumbers(numbers));  // 20
```

### Example 2: User Transformation

```javascript
const prop = key => obj => obj[key];
const map = fn => array => array.map(fn);
const filter = predicate => array => array.filter(predicate);

const getActiveUserNames = pipe(
    filter(user => user.active),
    map(prop('name'))
);

let users = [
    { name: "John", active: true },
    { name: "Sarah", active: false },
    { name: "Mike", active: true }
];

console.log(getActiveUserNames(users));  // ["John", "Mike"]
```

### Example 3: Text Processing

```javascript
const trim = str => str.trim();
const toLowerCase = str => str.toLowerCase();
const split = delimiter => str => str.split(delimiter);
const join = delimiter => array => array.join(delimiter);
const map = fn => array => array.map(fn);

const titleCase = str => 
    str.charAt(0).toUpperCase() + str.slice(1);

const processTitle = pipe(
    trim,
    toLowerCase,
    split(' '),
    map(titleCase),
    join(' ')
);

console.log(processTitle('  hello WORLD from JavaScript  '));
// "Hello World From Javascript"
```

---

## Point-Free Style

Writing functions without explicitly mentioning arguments.

```javascript
// Regular style (pointing to arguments)
const double = x => x * 2;
const doubleAll = numbers => numbers.map(double);

// Point-free style (no explicit arguments)
const doubleAll = map(double);

// Another example
const getNames = users => users.map(user => user.name);

// Point-free
const prop = key => obj => obj[key];
const getName = prop('name');
const getNames = map(getName);
```

---

## Real-World Application

### Build a Query Builder

```javascript
// Curried query functions
const select = (...fields) => data => 
    data.map(item => {
        let result = {};
        fields.forEach(field => {
            result[field] = item[field];
        });
        return result;
    });

const where = predicate => data => data.filter(predicate);

const orderBy = field => data => 
    [...data].sort((a, b) => {
        if (a[field] < b[field]) return -1;
        if (a[field] > b[field]) return 1;
        return 0;
    });

const limit = n => data => data.slice(0, n);

// Build query
const getTopActiveUsers = pipe(
    where(user => user.active),
    orderBy('score'),
    limit(3),
    select('name', 'score')
);

let users = [
    { name: "John", score: 85, active: true },
    { name: "Sarah", score: 92, active: false },
    { name: "Mike", score: 78, active: true },
    { name: "Emma", score: 95, active: true },
    { name: "Tom", score: 88, active: true }
];

console.log(getTopActiveUsers(users));
// [
//   { name: "Mike", score: 78 },
//   { name: "John", score: 85 },
//   { name: "Tom", score: 88 }
// ]
```

---

## Performance Considerations

### Memoization with Curried Functions

```javascript
const memoize = fn => {
    const cache = new Map();
    
    return function(...args) {
        const key = JSON.stringify(args);
        
        if (cache.has(key)) {
            console.log('From cache');
            return cache.get(key);
        }
        
        const result = fn(...args);
        cache.set(key, result);
        return result;
    };
};

// Expensive curried function
const expensiveCalc = memoize(
    a => b => c => {
        console.log('Computing...');
        // Expensive operation
        return a + b + c;
    }
);

let fn = expensiveCalc(1)(2);
console.log(fn(3));  // Computing... 6
console.log(fn(3));  // From cache 6
```

---

## Debugging Composed Functions

### Add Trace Function

```javascript
const trace = label => value => {
    console.log(`${label}:`, value);
    return value;
};

// Use in pipeline
const processData = pipe(
    trace('Input'),
    double,
    trace('After double'),
    square,
    trace('After square'),
    addOne,
    trace('Final')
);

processData(3);
// Input: 3
// After double: 6
// After square: 36
// Final: 37
```

---

## Practice Exercises

```javascript
// Exercise 1: Create a pipeline for user data
const users = [
    { name: "John", age: 30, salary: 50000, active: true },
    { name: "Sarah", age: 25, salary: 60000, active: false },
    { name: "Mike", age: 35, salary: 55000, active: true }
];

const processEmployees = pipe(
    filter(u => u.active),
    map(u => ({ ...u, bonus: u.salary * 0.1 })),
    sortBy('salary')
);

// Exercise 2: Create curried math operations
const add = a => b => a + b;
const multiply = a => b => a * b;
const power = a => b => Math.pow(a, b);

const add5 = add(5);
const double = multiply(2);
const square = power(2);

// Exercise 3: Build a form validator
const createValidator = pipe(
    trim,
    validateLength(8),
    validatePattern(/^[a-zA-Z0-9]+$/),
    validateNoSpaces
);

// Exercise 4: Create a text formatter
const formatText = pipe(
    trim,
    removeExtraSpaces,
    capitalizeFirstLetter,
    addPeriodIfMissing
);
```

---

## Libraries for Functional Programming

Popular libraries that provide composition and currying:

```javascript
// Ramda
import { pipe, curry, map, filter } from 'ramda';

// Lodash/FP
import { flow, curry, map, filter } from 'lodash/fp';

// But you can build your own lightweight version!
```

---

## Key Takeaways âœ“

- [ ] Composition combines simple functions into complex ones
- [ ] Pipe flows data left to right
- [ ] Compose flows data right to left
- [ ] Currying transforms multi-arg functions into single-arg chains
- [ ] Currying enables partial application
- [ ] Point-free style removes explicit arguments
- [ ] Composition + currying = powerful data pipelines
- [ ] Use trace functions for debugging
- [ ] Functional programming leads to reusable, testable code

**Next:** Build the Expense Tracker! Go to `project-expense-tracker/` ðŸ’ª