# Module 04 - Lesson 1: Higher-Order Functions & Callbacks

## What Are Higher-Order Functions?

A **higher-order function** is a function that:
1. Takes one or more functions as arguments, OR
2. Returns a function as its result

Think of them as "function managers" - they work with other functions!

**You've already used them!**
```javascript
// Array methods are higher-order functions!
[1, 2, 3].forEach(function(num) {
    console.log(num);
});

// forEach TAKES a function as an argument
```

---

## Callbacks - Functions as Arguments

A **callback** is a function passed as an argument to another function.

### Basic Example

```javascript
// Regular function
function greet(name) {
    console.log("Hello, " + name);
}

// Higher-order function that takes a callback
function processUser(name, callback) {
    console.log("Processing user...");
    callback(name);  // Call the callback function
}

// Pass greet as a callback
processUser("Ifeanyi", greet);
// Output:
// Processing user...
// Hello, Ifeanyi
```

### Anonymous Callback

```javascript
// Pass function directly without naming it
processUser("Sarah", function(name) {
    console.log("Welcome, " + name + "!");
});
// Output:
// Processing user...
// Welcome, Sarah!
```

### Arrow Function Callback

```javascript
// Modern way with arrow function
processUser("Mike", (name) => {
    console.log(`Hi ${name}!`);
});
// Output:
// Processing user...
// Hi Mike!
```

---

## Why Use Callbacks?

### 1. Code Reusability

```javascript
// One function, multiple behaviors
function calculate(a, b, operation) {
    return operation(a, b);
}

// Different operations
function add(x, y) {
    return x + y;
}

function multiply(x, y) {
    return x * y;
}

function subtract(x, y) {
    return x - y;
}

console.log(calculate(5, 3, add));       // 8
console.log(calculate(5, 3, multiply));  // 15
console.log(calculate(5, 3, subtract));  // 2

// Or use inline arrow functions
console.log(calculate(10, 2, (x, y) => x / y));  // 5
```

### 2. Abstraction & Flexibility

```javascript
// Generic function to process array items
function processArray(array, callback) {
    let results = [];
    for (let item of array) {
        results.push(callback(item));
    }
    return results;
}

let numbers = [1, 2, 3, 4, 5];

// Square each number
let squared = processArray(numbers, (n) => n * n);
console.log(squared);  // [1, 4, 9, 16, 25]

// Double each number
let doubled = processArray(numbers, (n) => n * 2);
console.log(doubled);  // [2, 4, 6, 8, 10]

// Convert to strings
let strings = processArray(numbers, (n) => `Number: ${n}`);
console.log(strings);  // ["Number: 1", "Number: 2", ...]
```

### 3. Asynchronous Operations

```javascript
// Simulate API call
function fetchUserData(userId, onSuccess, onError) {
    console.log("Fetching user data...");
    
    // Simulate delay
    setTimeout(() => {
        // Simulate random success/failure
        if (Math.random() > 0.2) {
            // Success callback
            onSuccess({
                id: userId,
                name: "Ifeanyi",
                email: "ifeanyi@example.com"
            });
        } else {
            // Error callback
            onError("Failed to fetch user data");
        }
    }, 1000);
}

// Use it
fetchUserData(
    123,
    (user) => {
        console.log("Success!", user);
    },
    (error) => {
        console.log("Error:", error);
    }
);
```

---

## Built-in Higher-Order Functions

JavaScript arrays have many built-in higher-order functions!

### forEach() - Execute Function for Each Element

```javascript
let fruits = ["Apple", "Banana", "Orange"];

// Pass callback to forEach
fruits.forEach(function(fruit, index) {
    console.log(`${index}: ${fruit}`);
});
// 0: Apple
// 1: Banana
// 2: Orange

// With arrow function
fruits.forEach((fruit, index) => {
    console.log(`${index}: ${fruit}`);
});
```

### map() - Transform Each Element

```javascript
let numbers = [1, 2, 3, 4, 5];

// Square each number
let squared = numbers.map(function(num) {
    return num * num;
});
console.log(squared);  // [1, 4, 9, 16, 25]

// Arrow function (shorter!)
let doubled = numbers.map(num => num * 2);
console.log(doubled);  // [2, 4, 6, 8, 10]

// Real example: Extract properties
let users = [
    { name: "John", age: 25 },
    { name: "Sarah", age: 30 },
    { name: "Mike", age: 28 }
];

let names = users.map(user => user.name);
console.log(names);  // ["John", "Sarah", "Mike"]

let ages = users.map(user => user.age);
console.log(ages);  // [25, 30, 28]
```

### filter() - Keep Elements That Pass Test

```javascript
let numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

// Get even numbers
let evens = numbers.filter(function(num) {
    return num % 2 === 0;
});
console.log(evens);  // [2, 4, 6, 8, 10]

// Get numbers greater than 5
let bigNumbers = numbers.filter(num => num > 5);
console.log(bigNumbers);  // [6, 7, 8, 9, 10]

// Real example: Filter users
let users = [
    { name: "John", age: 17, active: true },
    { name: "Sarah", age: 25, active: true },
    { name: "Mike", age: 16, active: false },
    { name: "Emma", age: 30, active: true }
];

// Get active adults
let activeAdults = users.filter(user => {
    return user.age >= 18 && user.active;
});
console.log(activeAdults);
// [{ name: "Sarah", age: 25, active: true }, 
//  { name: "Emma", age: 30, active: true }]
```

### reduce() - Reduce to Single Value

```javascript
let numbers = [1, 2, 3, 4, 5];

// Sum all numbers
let sum = numbers.reduce(function(total, num) {
    return total + num;
}, 0);
console.log(sum);  // 15

// How it works step by step:
// total = 0, num = 1 â†’ return 0 + 1 = 1
// total = 1, num = 2 â†’ return 1 + 2 = 3
// total = 3, num = 3 â†’ return 3 + 3 = 6
// total = 6, num = 4 â†’ return 6 + 4 = 10
// total = 10, num = 5 â†’ return 10 + 5 = 15

// Arrow function
let product = numbers.reduce((total, num) => total * num, 1);
console.log(product);  // 120

// Real example: Count items
let cart = [
    { item: "Laptop", price: 1000, quantity: 1 },
    { item: "Mouse", price: 20, quantity: 2 },
    { item: "Keyboard", price: 50, quantity: 1 }
];

let total = cart.reduce((sum, item) => {
    return sum + (item.price * item.quantity);
}, 0);
console.log("Total:", total);  // Total: 1090

// Group by property
let people = [
    { name: "John", city: "Lagos" },
    { name: "Sarah", city: "Abuja" },
    { name: "Mike", city: "Lagos" },
    { name: "Emma", city: "Abuja" }
];

let grouped = people.reduce((groups, person) => {
    let city = person.city;
    if (!groups[city]) {
        groups[city] = [];
    }
    groups[city].push(person.name);
    return groups;
}, {});

console.log(grouped);
// { Lagos: ["John", "Mike"], Abuja: ["Sarah", "Emma"] }
```

### find() - Find First Match

```javascript
let users = [
    { id: 1, name: "John" },
    { id: 2, name: "Sarah" },
    { id: 3, name: "Mike" }
];

// Find user with id 2
let user = users.find(function(u) {
    return u.id === 2;
});
console.log(user);  // { id: 2, name: "Sarah" }

// Arrow function
let found = users.find(u => u.name === "Mike");
console.log(found);  // { id: 3, name: "Mike" }
```

### some() & every() - Test Elements

```javascript
let numbers = [1, 2, 3, 4, 5];

// some(): True if ANY element passes test
let hasEven = numbers.some(num => num % 2 === 0);
console.log(hasEven);  // true

let hasNegative = numbers.some(num => num < 0);
console.log(hasNegative);  // false

// every(): True if ALL elements pass test
let allPositive = numbers.every(num => num > 0);
console.log(allPositive);  // true

let allEven = numbers.every(num => num % 2 === 0);
console.log(allEven);  // false

// Real example: Form validation
let formFields = [
    { name: "email", value: "test@example.com", valid: true },
    { name: "password", value: "12345678", valid: true },
    { name: "age", value: "25", valid: true }
];

let formValid = formFields.every(field => field.valid);
console.log("Form valid:", formValid);  // true
```

### sort() - Sort with Custom Comparator

```javascript
let numbers = [5, 2, 8, 1, 9];

// Ascending order
numbers.sort((a, b) => a - b);
console.log(numbers);  // [1, 2, 5, 8, 9]

// Descending order
numbers.sort((a, b) => b - a);
console.log(numbers);  // [9, 8, 5, 2, 1]

// Sort objects
let users = [
    { name: "John", age: 30 },
    { name: "Sarah", age: 25 },
    { name: "Mike", age: 35 }
];

// Sort by age
users.sort((a, b) => a.age - b.age);
console.log(users);
// [{ name: "Sarah", age: 25 }, 
//  { name: "John", age: 30 },
//  { name: "Mike", age: 35 }]

// Sort by name (alphabetically)
users.sort((a, b) => a.name.localeCompare(b.name));
console.log(users);
// [{ name: "John", ... }, { name: "Mike", ... }, { name: "Sarah", ... }]
```

---

## Chaining Higher-Order Functions

Combine multiple operations!

```javascript
let numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

// Get even numbers, square them, sum them
let result = numbers
    .filter(num => num % 2 === 0)    // [2, 4, 6, 8, 10]
    .map(num => num * num)            // [4, 16, 36, 64, 100]
    .reduce((sum, num) => sum + num, 0);  // 220

console.log(result);  // 220

// Real example: Process products
let products = [
    { name: "Laptop", price: 1200, category: "Electronics", inStock: true },
    { name: "Phone", price: 800, category: "Electronics", inStock: true },
    { name: "Desk", price: 300, category: "Furniture", inStock: false },
    { name: "Chair", price: 150, category: "Furniture", inStock: true },
    { name: "Monitor", price: 400, category: "Electronics", inStock: true }
];

// Get electronics in stock, apply 10% discount, get names
let discountedElectronics = products
    .filter(p => p.category === "Electronics" && p.inStock)
    .map(p => ({
        name: p.name,
        originalPrice: p.price,
        salePrice: p.price * 0.9
    }));

console.log(discountedElectronics);
// [
//   { name: "Laptop", originalPrice: 1200, salePrice: 1080 },
//   { name: "Phone", originalPrice: 800, salePrice: 720 },
//   { name: "Monitor", originalPrice: 400, salePrice: 360 }
// ]
```

---

## Creating Your Own Higher-Order Functions

### Example 1: Repeat Function

```javascript
// Execute a function multiple times
function repeat(times, callback) {
    for (let i = 0; i < times; i++) {
        callback(i);
    }
}

// Use it
repeat(3, (i) => {
    console.log(`Iteration ${i}`);
});
// Iteration 0
// Iteration 1
// Iteration 2

repeat(5, () => {
    console.log("Hello!");
});
// Hello!
// Hello!
// Hello!
// Hello!
// Hello!
```

### Example 2: Unless Function

```javascript
// Execute callback UNLESS condition is true
function unless(condition, callback) {
    if (!condition) {
        callback();
    }
}

// Use it
let age = 15;
unless(age >= 18, () => {
    console.log("Access denied: Too young");
});
// Access denied: Too young

let age2 = 25;
unless(age2 >= 18, () => {
    console.log("Access denied: Too young");
});
// (nothing printed)
```

### Example 3: Timer Function

```javascript
// Execute callback after delay
function after(seconds, callback) {
    setTimeout(callback, seconds * 1000);
}

// Use it
console.log("Starting...");
after(2, () => {
    console.log("2 seconds passed!");
});
after(5, () => {
    console.log("5 seconds passed!");
});
```

### Example 4: Retry Function

```javascript
// Retry callback until it succeeds or max attempts reached
function retry(callback, maxAttempts) {
    let attempts = 0;
    
    function attempt() {
        attempts++;
        console.log(`Attempt ${attempts}...`);
        
        let success = callback();
        
        if (success) {
            console.log("Success!");
        } else if (attempts < maxAttempts) {
            console.log("Failed, retrying...");
            setTimeout(attempt, 1000);
        } else {
            console.log("Max attempts reached, giving up.");
        }
    }
    
    attempt();
}

// Use it
let successRate = 0;
retry(() => {
    successRate += 0.3;
    return Math.random() < successRate;  // Gradually increase chance
}, 5);
```

---

## Real-World Examples

### Example 1: User Authentication

```javascript
function authenticateUser(username, password, onSuccess, onError) {
    // Simulate API call
    setTimeout(() => {
        if (username === "admin" && password === "12345") {
            onSuccess({
                username: username,
                role: "admin",
                token: "abc123"
            });
        } else {
            onError("Invalid credentials");
        }
    }, 1000);
}

// Use it
authenticateUser(
    "admin",
    "12345",
    (user) => {
        console.log("Login successful!");
        console.log("Welcome,", user.username);
        console.log("Role:", user.role);
    },
    (error) => {
        console.log("Login failed:", error);
    }
);
```

### Example 2: Data Pipeline

```javascript
// Process data through multiple steps
function pipeline(data, ...operations) {
    return operations.reduce((result, operation) => {
        return operation(result);
    }, data);
}

// Processing functions
const toLowerCase = (str) => str.toLowerCase();
const removeSpaces = (str) => str.replace(/\s+/g, '');
const addPrefix = (str) => 'user_' + str;

// Use pipeline
let username = pipeline(
    "John Doe",
    toLowerCase,     // "john doe"
    removeSpaces,    // "johndoe"
    addPrefix        // "user_johndoe"
);

console.log(username);  // "user_johndoe"
```

### Example 3: Event Emitter

```javascript
function createEventEmitter() {
    const events = {};
    
    return {
        on(eventName, callback) {
            if (!events[eventName]) {
                events[eventName] = [];
            }
            events[eventName].push(callback);
        },
        
        emit(eventName, data) {
            if (events[eventName]) {
                events[eventName].forEach(callback => {
                    callback(data);
                });
            }
        }
    };
}

// Use it
const emitter = createEventEmitter();

emitter.on('userLogin', (user) => {
    console.log(`${user.name} logged in`);
});

emitter.on('userLogin', (user) => {
    console.log(`Logging activity for ${user.name}`);
});

emitter.emit('userLogin', { name: 'Ifeanyi', id: 123 });
// Ifeanyi logged in
// Logging activity for Ifeanyi
```

### Example 4: Form Validator

```javascript
function createValidator(rules) {
    return function(value) {
        for (let rule of rules) {
            if (!rule.test(value)) {
                return rule.message;
            }
        }
        return null;  // Valid
    };
}

// Create validators
const emailValidator = createValidator([
    {
        test: (value) => value.length > 0,
        message: "Email is required"
    },
    {
        test: (value) => value.includes("@"),
        message: "Email must contain @"
    },
    {
        test: (value) => value.includes("."),
        message: "Email must contain domain"
    }
]);

const passwordValidator = createValidator([
    {
        test: (value) => value.length >= 8,
        message: "Password must be at least 8 characters"
    },
    {
        test: (value) => /[A-Z]/.test(value),
        message: "Password must contain uppercase letter"
    },
    {
        test: (value) => /[0-9]/.test(value),
        message: "Password must contain number"
    }
]);

// Use validators
console.log(emailValidator("test@example.com"));  // null (valid)
console.log(emailValidator("invalid"));           // "Email must contain @"
console.log(passwordValidator("Pass123"));        // null (valid)
console.log(passwordValidator("short"));          // "Password must be at least 8 characters"
```

---

## Common Patterns

### Pattern 1: Once Function

```javascript
// Execute callback only once
function once(callback) {
    let called = false;
    let result;
    
    return function(...args) {
        if (!called) {
            called = true;
            result = callback(...args);
        }
        return result;
    };
}

// Use it
const initializeApp = once(() => {
    console.log("App initialized!");
    return "Done";
});

console.log(initializeApp());  // "App initialized!" â†’ "Done"
console.log(initializeApp());  // "Done" (doesn't log again)
console.log(initializeApp());  // "Done" (doesn't log again)
```

### Pattern 2: Memoization

```javascript
// Cache function results
function memoize(callback) {
    const cache = {};
    
    return function(arg) {
        if (cache[arg] !== undefined) {
            console.log("From cache:", arg);
            return cache[arg];
        }
        
        console.log("Computing:", arg);
        const result = callback(arg);
        cache[arg] = result;
        return result;
    };
}

// Expensive function
const factorial = memoize(function(n) {
    if (n <= 1) return 1;
    return n * factorial(n - 1);
});

console.log(factorial(5));  // Computing... â†’ 120
console.log(factorial(5));  // From cache â†’ 120
console.log(factorial(6));  // Computing... â†’ 720
```

---

## Practice Exercises

```javascript
// Exercise 1: Create a function that filters array by multiple conditions
function filterByConditions(array, ...tests) {
    return array.filter(item => {
        return tests.every(test => test(item));
    });
}

let products = [
    { name: "Laptop", price: 1000, inStock: true },
    { name: "Phone", price: 500, inStock: false },
    { name: "Tablet", price: 300, inStock: true }
];

let available = filterByConditions(
    products,
    p => p.inStock,
    p => p.price < 800
);
console.log(available);  // [{ name: "Tablet", ... }]

// Exercise 2: Create a function that applies transformations in sequence
function transform(value, ...transformers) {
    return transformers.reduce((result, transformer) => {
        return transformer(result);
    }, value);
}

let result = transform(
    "  Hello World  ",
    str => str.trim(),
    str => str.toLowerCase(),
    str => str.replace(/\s+/g, '-')
);
console.log(result);  // "hello-world"

// Exercise 3: Create a debounce function
function debounce(callback, delay) {
    let timeoutId;
    
    return function(...args) {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => {
            callback(...args);
        }, delay);
    };
}

// Use with search
const search = debounce((query) => {
    console.log("Searching for:", query);
}, 500);

search("java");
search("javasc");
search("javascript");
// Only logs "Searching for: javascript" after 500ms
```

---

## Key Takeaways âœ“

- [ ] Higher-order functions take or return functions
- [ ] Callbacks are functions passed as arguments
- [ ] Array methods (map, filter, reduce) are HOFs
- [ ] Callbacks enable code reusability
- [ ] Can chain multiple HOFs together
- [ ] HOFs enable functional programming patterns
- [ ] Create your own HOFs for custom logic

**Next:** Closures & Scope! Open `02-closures-scope.md` ðŸ’ª